
# Embedded Device  
## Threat Model v 1.0

You can use this document as a template to perform Threat Modeling or a checklist to prepare for Security Requirements for any type of Embedded Device/System. 

## Definition 
An embedded device is a computer system having a microprocessor/microcontroller, memory, input/output peripheral device, along with a software that has a dedicated function within a larger mechanical or electronic system. 
## Basic Architecture 
![image](https://github.com/user-attachments/assets/5d61f9e3-ad9b-4aec-872b-0467d78ad8c3)

## Context and Environment 

When doing threat modeling, it is essential to have an in-depth context and understanding of the eco-system. Gather and add as much information as required/possible. This activity also helps in understanding the scope/boundary of the system for which threat modeling needs to be done. 

**Attribute**                            | Information to Capture                                                             
---------------------------------------- | --------------------------------------------------------------------
**Device Name**                          | xxxxxxx                                                             
**Type of Device**                       | standalone, networked, realtime etc                                 
**Technology Stack/Components**          | e.g. Device Model, OS, Firmware, Components                         
**Purpose/Functionality**                | business use                                                        
**List of Users**                        | end users, administrators                                           
**List of Systems/Components Connected** | Integrated systems or components                                    
**Asset Classification**                 |  from the perspective of Confidentiality, Integrity and Availability
**Data/Information Classification**      |  from the perspective of Confidentiality, Integrity and Availability
**Installation Location**                | Car, Road, Factory, Home, Office                                    
**Device Physical Exposure**             | Public, Internal, Restricted, Private, Facing                       
**Criticality**                          | Mission, Safety, Time                                               


## Identify Applicable Threats 

Select or Brainstorm Threats for your device under review. It is essential to discuss with business, product, data owner and other applicable stakeholders asking the question e.g. **"What can go wrong?"** 

**Check/Apply** | **Threat**                       | **Definition/Description**                                                                                                                                                                                                                                                                                                                                      
--------------- | -------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
[ ]             | Command/Code Injection           | Involves executing arbitrary commands/code on the target system.                                                                                                                                                                                                                                                                                                
[ ]             | Unauthorized Access/Use          | Logical or Physical access without permission to the target system.                                                                                                                                                                                                                                                                                             
[ ]             | Malware Infection                | A malicious software (including but not limited to virus, worm, trojan) use to conduct unwanted or malicious behavior on the target system.                                                                                                                                                                                                                     
[ ]             | Buffer Overflow                  | An anomaly where the program while writing data to memory, overruns its boundary and overwrites adjacent memory location causing incorrect results, crashes or malicious code execution.                                                                                                                                                                        
[ ]             | Brute Force Access               | A systematic method used to discover passwords, encryption keys etc by trying every possible combination or letters, numbers and special characters.                                                                                                                                                                                                            
[ ]             | Data Theft/Exfiltration          | Unauthorized data transfer from the target system using manual or automated techniques.                                                                                                                                                                                                                                                                         
[ ]             | Side Channel Analysis/Attack     | An attack which makes use of the information leakage through timing, electromagnetic radiation, power consumption, light or sound of the target system to exfiltrate sensitive information e.g. cryptographic keys. Generally side channel attacks are passive in nature i.e. the attacker only observes the leakage and tries to extract sensitive information.
[ ]             | Reverse Engineering (H/W, S/W)   | The process in which software or hardware is deconstructed to extract the internal design information which can be further used to study any weakness, preparing targeted exploits, cloning or counterfeiting.                                                                                                                                                  
[ ]             | Fault Injection                  | This type of attack manipulates the target system to compromise the security by altering clock, change in voltage supply, electromagnetic radiation exposure or high intensity light source. Sometimes these kinds of attack is also known as Active Side Channel Attack.                                                                                       
[ ]             | Device Reset to Insecure State   | An activity through which the device is hard reset or factory reset where all settings and data including any security settings are removed leaving the device in insecure state.                                                                                                                                                                               
[ ]             | Device Tampering/Theft           | It is an act of physical interfering with device hardware for malicious intents. This can include but not limited to physically opening the device, accessing any components or installing any malicious/skimming devices.                                                                                                                                      
[ ]             | Denial Of Service                | It is an attack used to make the device unusable temporarily or permanently for its intended mission.                                                                                                                                                                                                                                                           
[ ]             | Credential Theft/Leakage         | A malicious activity in which credentials are stolen due to insufficient or insecure practices implemented for handling credentials.                                                                                                                                                                                                                            
[ ]             | Open Backdoors                   | An intentional or unintentional introduction of alternative path in a device or software to bypass the mandatory access control or security measures.                                                                                                                                                                                                           
[ ]             | Privilege Escalation             | An activity used to gain unauthorized elevated or additional access into a device or a functionality usually by-passing the approved authorization channel/flow.                                                                                                                                                                                                
[ ]             | Device Reconnaissance            | Techniques used to perform visual exterior analysis of the device and its components or opening a device and finding information of various components from its data sheet. This is considered as a first step towards launching subsequent attacks based on the information gathered.                                                                          
[ ]             | Business Logic Bypass            | It refers to the ability to circumvent the rules, constraints, workflows etc in the system for malicious activities e.g. device operation depending on a particular time of the day which can be manipulated.                                                                                                                                                   
[ ]             | Misconfigurations                | Software, Hardware or Security settings that are not implemented in the optimal way. E.g. implementation of default of insecure settings.                                                                                                                                                                                                                       
[ ]             | Undetected Suspicious Activities | It refers to the inability of a system to detect or alert about any malicious/suspicious/unknown operation which is generally not performed by the system.                                                                                                                                                                                                      
[ ]             | Lack of Accountability           | It refers to the inability of a system to provide undeniable evidence about the activities (who, what when, how) performed in the system.                                                                                                                                                                                                                       
[ ]             | Malicious Hardware Additions     | A technique used to introduce or implant a piece of a malicious hardware (device, accessory) which resembles the normal/actual device.                                                                                                                                                                                                                          
[ ]             | Power Failure                    | Not able to sufficiently control the power required to the target system causing it to fail or malfunction.                                                                                                                                                                                                                                                     

## Identify Applicable Mitigations 
There can be multiple mitigation techniques to prevent various types of  threats. In addition, not all mitigation techniques will prevent the threats completely, instead minimize the impact of the threats.  

Here comes the question **"How we can prevent or minimize the impact of threats?"**


Applicable Threat                | Mitigation/Control/Security Requirement                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
-------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Command/Code Injection           | Implement input validation. Apply allowed list. Do not use user input data directly in shell commands.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
Unauthorized Access/Use          | Implement strong authentication/authorization on debug ports. Implement strong/complex passwords requirements on all interfaces. Implement strong device specific credentials/passwords. Avoid Common Password for all devices. Based on classification of device implement physical access controls. Implement Secure Credential Storage in the Device. Implement uniform response for invalid and valid username. Implement password recovery/reset through out of band channel e.g. separate recovery tools. Implement strong authorization and access control policy/procedure. Implement strong Cryptographic algorithm over outdated ones.                                 
Malware Infection                | Implementation of Secure Boot. No firmware downgrade or unauthorized upgrade should be possible. The device should have the ability to patch the firmware in a secure way. Isolate hardware and software resources based on security domains.                                                                                                                                                                                                                                                                                                                                                                                                                                    
Buffer Overflow                  | Use safe language or apply best practice e.g. MISRA C, CERT C, C++ Restrict Memory Allocation, Switch to Readonly mode wherever possible, use of ASLR, ESP and Stack Canaries where possible to minimize the threat.                                                                                                                                                                                                                                                                                                                                                                                                                                                             
Brute Force Access               | Restrict Bad Login Attempts and implement lockout time and retry delays. Implement strong/complex passwords requirements on all interfaces.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
Data Theft/Exfiltration          | Implement strong Cryptographic algorithm over outdated ones. Data processed or generated among various device states should not be by default accessible/available to other device states. Implement strong authentication/authorization on debug ports. Implement strong/complex passwords requirements on all interfaces. Implement strong device specific credentials/passwords. Avoid Common Password for all devices. Based on classification of device implement physical access controls. Implement Secure Credential Storage in the Device. Isolate hardware and software resources based on security domains. Implement uniform response for invalid and valid username.
Side Channel Analysis/Attack     | Protect the Device with Radio Frequency Shielding. Device operations should be consistent and independent of type of data processed. Power consumption should be independent of operating instructions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
Reverse Engineering (H/W, S/W)   | Implement physical security of the Device, classify and protect confidential device information. Implement Secure SDLC and protect Source Code and Binaries. Introduce Tamperproof Fixtures, Remove H/W component identifiers, Implement S/W Code Obfuscation Techniques and Removal of Debug ports.                                                                                                                                                                                                                                                                                                                                                                             
Fault Injection                  | Implement Redundant Execution of Critical Security Functions in the Software. Introduce Hardware Sensors to detect any Injection Attacks. Implement Physical Device Hardening including but not limited to Shielding from radio frequency and ultraviolet light.                                                                                                                                                                                                                                                                                                                                                                                                                 
Device Reset to Insecure State   | Based on classification of device implement physical security controls. Increase Vigilance, Monitoring or Tamper detection controls e.g. sensors, alarms for unauthorized access.Implement audit logging based on type of device and software based alerting mechanism.                                                                                                                                                                                                                                                                                                                                                                                                          
Device Tampering/Theft           | Based on classification of device implement physical security controls. Increase Vigilance, Monitoring or Tamper detection controls e.g. sensors, alarms for unauthorized access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
Denial Of Service                | Implement a strategy to have dual/redundant power source. Follow software development best practices. e.g. MISRA C, CERT C, C++. Based on classification of device implement physical security controls. Disable non-essential services, ports, protocols etc.                                                                                                                                                                                                                                                                                                                                                                                                                   
Credential Theft/Leakage         | Implement strong device specific credentials/passwords. Avoid Common Password for all devices. Implement Secure Credential Storage in the Device. Implement secure process to set device credentials. Minimize the credential exposure within the team members. Do not hardcode credentials in source code. Improve Software Quality Control, Strengthen Secure SDLC.                                                                                                                                                                                                                                                                                                            
Open Backdoors                   | Disable non-essential services, ports, protocols etc, keep software bill of materials. Improve Software Quality Control, Strengthen Secure SDLC. Ensure no debug/test functionality exists. Implement strong/complex passwords requirements on all interfaces. Implement authentication/authorization on debug ports.                                                                                                                                                                                                                                                                                                                                                            
Privilege Escalation             | Isolate hardware and software resources based on security domains. Implement Software Access Control Policies and/or Hardware enforced partitions e.g. ARM TrustZone. Implement strong authorization and access control policy/procedure.                                                                                                                                                                                                                                                                                                                                                                                                                                        
Device Reconnaissance            | Implement physical security of the hardware, classify and protect confidential device information. Remove H/W component identifiers, Implement S/W Code Obfuscation Techniques and Removal of Debug ports. Increase Vigilance, Monitoring e.g. sensors, alarms for unauthorized access.                                                                                                                                                                                                                                                                                                                                                                                          
Business Logic Bypass            | Improve Software Quality Control, Strengthen Secure SDLC.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
Misconfigurations                | Strengthen device commissioning, configuration and maintenance/change process. Improve Software Quality Control, Strengthen Secure SDLC.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
Undetected Suspicious Activities | Implement secure audit logging and alerting based on type of device and wherever possible. Strengthen device commissioning, configuration, maintenance/change process. Centralize and collect device audit logs in a tamper proof storage/system.                                                                                                                                                                                                                                                                                                                                                                                                                                
Lack of Accountability           | Implement secure audit logging based on type of device and wherever possible. Strengthen device commissioning, configuration, maintenance/change process. Centralize and collect device audit logs in a tamper proof storage/system.                                                                                                                                                                                                                                                                                                                                                                                                                                             
Malicious Hardware Additions     | Based on classification of device implement physical security controls. Increase Vigilance, Monitoring or Tamper detection controls e.g. sensors, alarms for unauthorized access. Strengthen device commissioning, configuration, maintenance/change process.                                                                                                                                                                                                                                                                                                                                                                                                                    
Power Failure                    | Implement a strategy to have dual/redundant and reliable power source.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
